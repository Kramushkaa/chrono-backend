# Настройка базы данных Хронониндзя

## Обзор

Этот документ описывает процесс настройки базы данных для проекта Хронониндзя.

## Структура базы данных

### Таблицы
- `persons` - основная таблица с историческими личностями

### Представления (Views)
- `unique_categories` - уникальные категории исторических личностей
- `unique_countries` - уникальные страны исторических личностей

### Индексы
- `idx_persons_category` - индекс для категорий
- `idx_persons_country` - индекс для стран
- `idx_persons_birth_year` - индекс для года рождения
- `idx_persons_death_year` - индекс для года смерти
- `idx_persons_birth_death_years` - составной индекс для диапазона лет
- `idx_persons_id` - индекс для ID

## Команды для настройки

### Заполнение данными
```bash
npm run seed
```

## Подключение к базе данных

Backend автоматически выбирает конфигурацию в зависимости от окружения:

### Локальная разработка (NODE_ENV=development или не задан)
- Используйте локальный PostgreSQL (`DB_HOST=localhost`, `DB_NAME=chrononinja`).

### Продакшен (NODE_ENV=production)
- Все параметры подключения задаются только через переменные окружения.

### Переопределение через переменные окружения
Можно переопределить любые параметры через переменные окружения:
- `DB_HOST` - хост базы данных
- `DB_PORT` - порт (по умолчанию 5432)
- `DB_NAME` - имя базы данных (по умолчанию `chrononinja`)
- `DB_USER` - пользователь
- `DB_PASSWORD` - пароль

## API Endpoints

- `GET /api/persons` - получить всех исторических личностей
- `GET /api/categories` - получить уникальные категории
- `GET /api/countries` - получить уникальные страны
- `GET /api/stats` - получить статистику

## Производительность

Индексы оптимизированы для следующих типов запросов:
- Фильтрация по категориям
- Фильтрация по странам
- Фильтрация по временным периодам
- Сортировка по годам
- Поиск по ID

## Мониторинг

База данных уже настроена и оптимизирована. Все индексы и представления созданы и работают корректно. 